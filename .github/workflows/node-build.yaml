name: "Build"
on:
  workflow_call:
    inputs:
      build_script:
        type: string
        description: "Build script to be executed"
        default: 'npm run build'
    secrets:
      PERSONAL_ACCESS_TOKEN:
        description: "Github personal access token"
        required: true

jobs:
  # ***********************************
  # Job: Build Packages
  # ***********************************
  build:
    name: "Build Packages"
    runs-on: ubuntu-latest
    steps:
      - name: "Setup Environment"
        uses: panates/gh-setup-node@v1
        with:
          token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
          fetch-depth: 0

      - name: "Scan Environment"
        id: environment
        uses: panates/gh-repository-info@v1
        with:
          token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}

#      - name: "Build"
#        shell: bash
#        run: |
#          ${{ inputs.build_script }}
#

      - name: Parse Directories in Bash
        shell: bash
        run: |
          PACKAGES='${{ needs.environment.outputs.packages }}'
          echo $PACKAGES
           
          echo "Processing packages..."
          echo "$PACKAGES" | jq -c '.[]' | while IFS= read -r package; do
            name=$(echo "package" | jq -r '.name')
            version=$(echo "$package" | jq -r '.version')
           
            echo "Package Name: $name"
            echo "Package Version: $version"
          done
